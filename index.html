<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>四分化训练Pro</title>
    <link rel="manifest" href="manifest.json">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="theme-color" content="#f5f5f7">

    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            background-color: #f5f5f7;
            color: #333;
            margin: 0;
            padding: 20px;
            padding-top: 40px;
            display: flex;
            flex-direction: column;
            align-items: center;
            -webkit-tap-highlight-color: transparent;
        }
        h1 { font-size: 1.6rem; margin-bottom: 5px; color: #1c1c1e; }
        h2 { font-size: 1rem; color: #8e8e93; font-weight: normal; margin-bottom: 24px; }
        
        .card {
            background: white;
            width: 100%;
            max-width: 450px;
            border-radius: 18px;
            box-shadow: 0 8px 20px rgba(0,0,0,0.04);
            padding: 10px 20px;
            box-sizing: border-box;
            margin-bottom: 20px;
        }

        .workout-item {
            display: flex;
            flex-wrap: wrap;
            align-items: flex-start;
            padding: 16px 0;
            border-bottom: 1px solid #f0f0f0;
        }
        .workout-item:last-child { border-bottom: none; }

        .item-header {
            display: flex;
            width: 100%;
            align-items: flex-start;
            cursor: pointer;
        }

        .checkbox {
            min-width: 24px;
            height: 24px;
            border: 2px solid #007aff;
            border-radius: 50%;
            margin-right: 16px;
            margin-top: 2px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
        }
        
        .text-content { display: flex; flex-direction: column; flex: 1; }
        .action-name { font-size: 1rem; font-weight: 500; margin-bottom: 4px; }
        .action-note { font-size: 0.85rem; color: #8e8e93; line-height: 1.4; }

        .workout-item.completed .checkbox { background-color: #007aff; color: white; }
        .workout-item.completed .action-name { text-decoration: line-through; color: #c7c7cc; }
        
        .weight-input-area {
            width: 100%;
            margin-top: 10px;
            padding-left: 44px;
            display: flex;
            align-items: center;
        }
        
        .weight-input {
            background: #f2f2f7;
            border: none;
            border-radius: 8px;
            padding: 6px 10px;
            width: 80px;
            font-size: 0.9rem;
            color: #333;
            text-align: center;
            outline: none;
        }
        .weight-label {
            font-size: 0.85rem;
            color: #8e8e93;
            margin-left: 8px;
        }

        .btn {
            background: #007aff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 20px;
            font-size: 0.9rem;
            margin-top: 20px;
            cursor: pointer;
        }
        .btn-outline {
            background: transparent;
            color: #007aff;
            border: 1px solid #007aff;
        }
        .btn-danger {
            background: transparent;
            color: #ff3b30;
            border: 1px solid #ff3b30;
            font-size: 0.8rem;
            padding: 8px 15px;
        }

        #edit-modal {
            display: none;
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: white;
            z-index: 100;
            padding: 20px;
            box-sizing: border-box;
            flex-direction: column;
        }
        #json-editor {
            flex: 1;
            width: 100%;
            border: 1px solid #ccc;
            border-radius: 10px;
            padding: 10px;
            font-family: monospace;
            font-size: 14px;
            margin-bottom: 10px;
            background: #f9f9f9;
        }
        .editor-hint {
            font-size: 0.85rem;
            color: #666;
            margin-bottom: 10px;
            background: #eee;
            padding: 10px;
            border-radius: 8px;
        }
    </style>
</head>
<body>

    <h1 id="day-title">加载中...</h1>
    <h2 id="date-display">...</h2>

    <div class="card" id="list-container"></div>

    <div class="status-bar" id="progress-text">今日进度: 0%</div>

    <button class="btn btn-outline" onclick="openEditor()">⚙️ 修改/重置 训练计划</button>

    <div id="edit-modal">
        <h3>编辑计划 (JSON模式)</h3>
        <div class="editor-hint">
            在这里直接修改文字、组数或添加新动作。<br>
            注意保持 JSON 格式正确。
        </div>
        <textarea id="json-editor"></textarea>
        <div style="display: flex; gap: 10px; flex-wrap: wrap;">
            <button class="btn" onclick="savePlan()">保存并生效</button>
            <button class="btn btn-outline" onclick="closeEditor()">取消</button>
            <button class="btn btn-danger" onclick="resetToDefault()" style="margin-left:auto;">重置为默认四分化</button>
        </div>
    </div>

    <script>
    // 1. 完整的四分化训练计划数据
    // 使用反引号 (`) 包裹，支持换行和HTML标签
    const defaultPlan = {
        // 周一: 胸部 + 肩部(侧/前)
        1: [
            `平板卧推 | 75% 4组x6次 <br> <span class='note'>全程锁死肩胛骨，关注离心下放，不需要顶峰挤压</span>`,
            `坐姿哑铃推肩 | 3组x8-12次 <br> <span class='note'>以左手(弱侧)次数为准，肩胛骨不要锁死，随手臂自然活动</span>`,
            `双杠臂屈伸(胸肌版) | 3组x力竭 <br> <span class='note'>身体大幅前倾，含胸，腿向前伸或跪姿撅屁股，肘部微张</span>`,
            `器械夹胸 | 4组x12次 <br> <span class='note'>顶峰停顿1秒，感受挤压感</span>`,
            `哑铃侧平举 | 5-6组x15-20次 <br> <span class='note'>侧肩是宽度的关键</span>`
        ],

        // 周二: 休息日 (Active Recovery)
        2: [
            `休息日 (有氧恢复) <br> <span class='note'>促进血液循环，帮助恢复。可选慢跑或椭圆机 (25-40分钟)</span>`
        ],

        // 周三: 背部 + 肩部(后束) + 腹肌
        3: [
            `硬拉(传统或架上) | 80% 1组x6次 <br> <span class='note'>力量基石，做完一组高质量的大重量即可</span>`,
            `高位下拉 | 4组x12次`,
            `坐姿器械划船 | 4组x12次`,
            `直臂下压 | 4组x15-20次`,
            `绳索面拉 | 4组x15-20次 <br> <span class='note'>手肘拉得比肩膀高，拉向额头，不要耸肩</span>`,
            `悬垂举腿/反向卷腹 | 3组x力竭 <br> <span class='note'>针对下腹部，核心激活状态下做</span>`
        ],

        // 周四: 休息日
        4: [
            `休息日 <br> <span class='note'>多吃蛋白质，好好睡觉</span>`
        ],

        // 周五: 手臂(二头/三头) + 腹肌 + 有氧
        5: [
            `EZ杆碎颅者 | 3组x12次`,
            `EZ杆弯举 | 3组x12次`,
            `颈后臂屈伸 | 3组x12次`,
            `牧师凳弯举 | 3组x12次`,
            `绳索下压 | 3组x12次`,
            `上斜哑铃弯举 | 3组x12次`,
            `绳索伐木/俄罗斯转体 | 3组x15-20次 <br> <span class='note'>针对腹外斜肌</span>`,
            `有氧训练 | 20-30分钟 <br> <span class='note'>中等强度恒速(LISS)，如坡度快走(坡度10-12,速度4-5)</span>`
        ],

        // 周六: 休息日
        6: [
            `休息日 <br> <span class='note'>准备明天的练腿日</span>`
        ],

        // 周日: 腿部
        0: [
            `深蹲 | 80% 3组x6次 <br> <span class='note'>绝对力量训练</span>`,
            `哑铃原地后撤步蹲 | 3组x10-12次(每腿) <br> <span class='note'>向后撤步，对膝盖更友好</span>`,
            `哑铃罗马尼亚硬拉(RDL) | 4组x10-12次 <br> <span class='note'>微屈膝锁死，屁股后撅，感受大腿后侧强烈拉伸，腰背挺直</span>`,
            `腿屈伸 | 4组x15-20次`,
            `腿弯举 | 4组x12-20次`,
            `坐姿外展 | 2组x15-20次 <br> <span class='note'>身体前倾(趴着做)，避免阔筋膜张肌抽筋，孤立臀中肌</span>`
        ]
    };

    let weeklyPlan = defaultPlan;
    // 尝试读取本地自定义计划
    const storedPlan = localStorage.getItem('my_custom_plan');
    if (storedPlan) {
        try {
            weeklyPlan = JSON.parse(storedPlan);
        } catch(e) {
            console.error("计划解析失败，重置为默认");
        }
    }

    const dayNames = ["周日", "周一", "周二", "周三", "周四", "周五", "周六"];
    const now = new Date();
    const dayOfWeek = now.getDay(); 
    const dateStr = now.toISOString().split('T')[0]; 

    document.getElementById('day-title').innerText = dayNames[dayOfWeek] + "计划";
    document.getElementById('date-display').innerText = dateStr;
    renderList();

    function renderList() {
        const listContainer = document.getElementById('list-container');
        listContainer.innerHTML = '';
        
        const todayPlan = weeklyPlan[dayOfWeek] || [`休息日`];

        todayPlan.forEach((content, index) => {
            let title = content;
            let note = "";
            if (content.includes("<br>")) {
                const parts = content.split("<br>");
                title = parts[0];
                note = parts[1];
            }
            const pureActionName = title.split('|')[0].trim();

            const div = document.createElement('div');
            div.className = 'workout-item';
            
            const statusKey = `workout_${dateStr}_${index}`;
            const weightKey = `last_weight_${pureActionName}`;
            
            const isDone = localStorage.getItem(statusKey) === 'true';
            const lastWeight = localStorage.getItem(weightKey) || '';

            if (isDone) div.classList.add('completed');

            div.innerHTML = `
                <div class="item-header">
                    <div class="checkbox">${isDone ? '✔' : ''}</div>
                    <div class="text-content">
                        <span class="action-name">${title}</span>
                        ${note ? `<span class="action-note">${note}</span>` : ''}
                    </div>
                </div>
                <div class="weight-input-area">
                    <input type="number" class="weight-input" placeholder="${lastWeight ? lastWeight : '0'}" value="${lastWeight}">
                    <span class="weight-label">kg (上次: ${lastWeight ? lastWeight : '-'}kg)</span>
                </div>
            `;

            div.querySelector('.item-header').onclick = () => {
                const currentlyDone = div.classList.contains('completed');
                if (currentlyDone) {
                    div.classList.remove('completed');
                    div.querySelector('.checkbox').innerText = '';
                    localStorage.removeItem(statusKey);
                } else {
                    div.classList.add('completed');
                    div.querySelector('.checkbox').innerText = '✔';
                    localStorage.setItem(statusKey, 'true');
                }
                updateProgress();
            };

            const input = div.querySelector('input');
            input.oninput = (e) => {
                localStorage.setItem(weightKey, e.target.value);
                div.querySelector('.weight-label').innerText = `kg (已存)`;
            };

            listContainer.appendChild(div);
        });
        updateProgress();
    }

    function updateProgress() {
        const total = document.querySelectorAll('.workout-item').length;
        const done = document.querySelectorAll('.workout-item.completed').length;
        if(total <= 1) { // 如果项目太少（休息日），就不显示进度
            document.getElementById('progress-text').innerText = "今日目标: 休息/恢复";
            return;
        }
        const percent = Math.round((done / total) * 100);
        document.getElementById('progress-text').innerText = `完成度: ${done}/${total} (${percent}%)`;
    }

    function openEditor() {
        const editor = document.getElementById('json-editor');
        editor.value = JSON.stringify(weeklyPlan, null, 4);
        document.getElementById('edit-modal').style.display = 'flex';
    }

    function savePlan() {
        const editor = document.getElementById('json-editor');
        try {
            const newPlan = JSON.parse(editor.value);
            weeklyPlan = newPlan;
            localStorage.setItem('my_custom_plan', JSON.stringify(newPlan));
            renderList();
            closeEditor();
            alert("计划修改成功！");
        } catch (e) {
            alert("JSON 格式有误，请检查: \n1. 所有的文字都要用双引号包裹 \n2. 每一行结束要有逗号 \n3. 错误信息: " + e.message);
        }
    }

    // === 新增：重置功能 ===
    function resetToDefault() {
        if(confirm("确定要重置吗？这将覆盖你之前的自定义修改，恢复到初始的【四分化】计划。")) {
            weeklyPlan = defaultPlan;
            localStorage.removeItem('my_custom_plan'); // 清除本地的自定义存储
            renderList();
            closeEditor();
            alert("已恢复到标准四分化计划！");
        }
    }

    function closeEditor() {
        document.getElementById('edit-modal').style.display = 'none';
    }
    </script>
</body>
</html>
